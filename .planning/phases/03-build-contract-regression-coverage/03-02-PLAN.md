---
phase: 03-build-contract-regression-coverage
plan: 02
type: execute
wave: 2
depends_on: [01]
files_modified:
  - scripts/check_pack_contract.py
  - scripts/check_pack_contract.sh
  - README.md
autonomous: true
requirements: [TEST-02]
must_haves:
  truths:
    - Contract drift between CNA `bof_pack` schema and BOF parser extraction order/types is detected deterministically.
    - Contract checker emits machine-readable and human-readable pass/fail results.
    - Maintainers have a single documented command path for contract-regression verification.
  artifacts:
    - scripts/check_pack_contract.py
    - scripts/check_pack_contract.sh
    - README.md
  key_links:
    - `scripts/check_pack_contract.sh` invokes structured parser checks in `scripts/check_pack_contract.py` against `BOF_spawn.cna` and `Src/Bof.c`.
---

<objective>
Add structured contract-regression checks for CNA packing versus BOF parser contract semantics.

Purpose: satisfy TEST-02 by detecting order/type mapping drift with deterministic parser-aware validation.
Output: structured checker scripts with clear output and documented maintainer usage.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/03-build-contract-regression-coverage/03-RESEARCH.md
@BOF_spawn.cna
@Src/Bof.c
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement structured contract extraction and comparison checker</name>
  <files>scripts/check_pack_contract.py</files>
  <action>Create a Python checker that parses CNA packing schema (`bof_pack(..., "ZZZZiiiib", ...)`) and BOF parser extraction sequence (`BeaconDataExtract`/`BeaconDataInt`) into normalized structures, compares expected order/types, and exits non-zero on mismatch.</action>
  <verify><automated>python3 scripts/check_pack_contract.py --cna BOF_spawn.cna --bof Src/Bof.c</automated></verify>
  <done>Checker detects semantic contract drift and reports specific mismatch positions/types.</done>
</task>

<task type="auto">
  <name>Task 2: Add wrapper command and machine-readable output mode</name>
  <files>scripts/check_pack_contract.py, scripts/check_pack_contract.sh</files>
  <action>Add a shell wrapper for consistent invocation and implement JSON output mode (plus concise terminal summary) so checks are usable in both manual runs and automation pipelines.</action>
  <verify><automated>bash scripts/check_pack_contract.sh --json</automated></verify>
  <done>Contract-regression checks are callable through one wrapper and produce deterministic machine-readable pass/fail output.</done>
</task>

<task type="auto">
  <name>Task 3: Document contract-check workflow and triage guidance</name>
  <files>README.md</files>
  <action>Update README contract section with script-based checker usage, expected success output, and mismatch triage examples that map directly to CNA/BOF contract positions.</action>
  <verify><automated>rg -n 'check_pack_contract|contract-regression|ZZZZiiiib|BeaconData' README.md</automated></verify>
  <done>Maintainers can run and interpret contract-regression checks without re-deriving parser semantics manually.</done>
</task>

</tasks>

<verification>
- TEST-02 is represented in frontmatter and fully covered by tasks.
- Structured checker validates order/type drift deterministically.
- Script + docs wiring provides a repeatable maintainer workflow.
</verification>

<success_criteria>
- [ ] TEST-02 implemented completely.
- [ ] Structured contract checker detects CNA/BOF drift with explicit mismatch output.
- [ ] README documents canonical contract-regression command path.
</success_criteria>

<output>
After completion, create .planning/phases/03-build-contract-regression-coverage/03-02-SUMMARY.md.
</output>
