---
phase: 01-safety-defaults-contract-guardrails
plan: 03
type: execute
wave: 3
depends_on: [01, 02]
files_modified:
  - BOF_spawn.cna
  - Src/Bof.c
  - README.md
autonomous: true
requirements: [SAFE-03]
must_haves:
  truths:
    - Every dialog option and execution method maps deterministically to BOF parser fields.
    - Unknown execution-method values fail explicitly (no hidden fallback).
    - Packing/parsing contract is documented and synchronized with source.
  artifacts:
    - BOF_spawn.cna
    - Src/Bof.c
    - README.md
  key_links:
    - BOF_spawn.cna shared pack helper order matches Src/Bof.c parser order exactly.
    - README mapping table mirrors implemented packing/parsing behavior.
---

<objective>
Validate and document deterministic CNA-to-BOF contract mapping.

Purpose: prevent hidden fallback behavior and mapping drift.
Output: centralized mapping/packing logic plus synchronized contract documentation.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/01-safety-defaults-contract-guardrails/01-CONTEXT.md
@.planning/phases/01-safety-defaults-contract-guardrails/01-RESEARCH.md
@BOF_spawn.cna
@Src/Bof.c
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Centralize execution-method resolver and remove fallback semantics</name>
  <files>BOF_spawn.cna</files>
  <action>Introduce one shared resolver for execution-method string to integer mapping used by both aliases. Unknown values must hard-fail with explicit operator error and no implicit default fallback.</action>
  <verify><automated>rg -n 'resolve.*exec|unknown execution|fallback|Hijack RIP Direct|Hijack RIP Callback' BOF_spawn.cna</automated></verify>
  <done>Mapping logic exists in one place and is deterministic for all invocation paths.</done>
</task>

<task type="auto">
  <name>Task 2: Share one pack helper for both alias commands</name>
  <files>BOF_spawn.cna</files>
  <action>Create a single helper that assembles normalized integer flags and calls `bof_pack("ZZZZiiiib", ...)` once for both aliases. Keep explicit contract-order comments near the helper.</action>
  <verify><automated>rg -n 'bof_pack\(\$1, "ZZZZiiiib"|contract|spawn_beacon|spawn_shellcode' BOF_spawn.cna</automated></verify>
  <done>Both alias paths use the same packing implementation and field order.</done>
</task>

<task type="auto">
  <name>Task 3: Synchronize contract documentation in README and BOF comments</name>
  <files>README.md, Src/Bof.c</files>
  <action>Add/update a concise contract table mapping CNA fields to packed type/order and BOF parser targets. Update `go()` argument comments to mirror the exact same order and method enum mapping.</action>
  <verify><automated>rg -n 'ZZZZiiiib|BeaconDataExtract|BeaconDataInt|mapping|execution method' README.md Src/Bof.c</automated></verify>
  <done>Code comments and README document the same deterministic contract with no ambiguity.</done>
</task>

</tasks>

<verification>
- SAFE-03 mapped and complete.
- Mapping fallback removed and explicit failure behavior present.
- Docs and parser contract remain synchronized.
</verification>

<success_criteria>
- [ ] SAFE-03 fully addressed.
- [ ] No hidden mapping fallback remains.
- [ ] Contract documentation matches implementation.
</success_criteria>

<output>
After completion, create .planning/phases/01-safety-defaults-contract-guardrails/01-03-SUMMARY.md.
</output>
