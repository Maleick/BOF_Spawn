---
phase: 01-safety-defaults-contract-guardrails
plan: 03
type: execute
wave: 3
depends_on: [01, 02]
files_modified:
  - BOF_spawn.cna
  - Src/Bof.c
  - README.md
autonomous: true
requirements: [SAFE-03]
must_haves:
  truths:
    - Dialog options and execution methods map deterministically to BOF parser fields.
    - Unknown execution-method values fail explicitly without hidden fallback.
    - Packing/parsing contract is documented and synchronized with code.
  artifacts:
    - BOF_spawn.cna
    - Src/Bof.c
    - README.md
  key_links:
    - BOF_spawn.cna shared pack helper order matches Src/Bof.c parser decode order.
    - README mapping table mirrors implemented contract semantics.
---

<objective>
Validate and document deterministic CNA-to-BOF packing contract behavior.

Purpose: eliminate hidden fallback semantics and mapping drift risk.
Output: centralized mapping/packing logic and synchronized contract docs.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/01-safety-defaults-contract-guardrails/01-CONTEXT.md
@.planning/phases/01-safety-defaults-contract-guardrails/01-RESEARCH.md
@BOF_spawn.cna
@Src/Bof.c
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Centralize execution-method resolver and remove implicit fallback</name>
  <files>BOF_spawn.cna</files>
  <action>Replace duplicate per-alias method mapping with a shared resolver. Unknown method strings must return explicit operator error and halt dispatch.</action>
  <verify><automated>rg -n 'resolve.*exec|unknown execution|fallback|Hijack RIP Direct|Hijack RIP Callback' BOF_spawn.cna</automated></verify>
  <done>Execution method mapping is deterministic and shared across all command paths.</done>
</task>

<task type="auto">
  <name>Task 2: Use one shared packing helper for both aliases</name>
  <files>BOF_spawn.cna</files>
  <action>Create a shared helper that assembles normalized int fields and calls `bof_pack("ZZZZiiiib", ...)` for both aliases, with explicit contract-order comment nearby.</action>
  <verify><automated>rg -n 'bof_pack\(\$1, "ZZZZiiiib"|contract|spawn_beacon|spawn_shellcode' BOF_spawn.cna</automated></verify>
  <done>Both aliases pack through the same deterministic helper and order.</done>
</task>

<task type="auto">
  <name>Task 3: Synchronize mapping contract docs in README and parser comments</name>
  <files>README.md, Src/Bof.c</files>
  <action>Add concise mapping table documenting CNA field, packed type/order, and parser destination. Update `Src/Bof.c` comment block around `go()` argument parsing to match README mapping exactly.</action>
  <verify><automated>rg -n 'ZZZZiiiib|BeaconDataExtract|BeaconDataInt|mapping|execution method' README.md Src/Bof.c</automated></verify>
  <done>Documentation and parser comments match implemented contract without ambiguity.</done>
</task>

</tasks>

<verification>
- SAFE-03 appears in requirements mapping and is addressed by tasks.
- Hidden fallback semantics are removed from mapping path.
- README and source comments reflect the same packing/parsing contract.
</verification>

<success_criteria>
- [ ] SAFE-03 implemented completely.
- [ ] No hidden mapping fallback remains.
- [ ] Contract docs and code are synchronized.
</success_criteria>

<output>
After completion, create .planning/phases/01-safety-defaults-contract-guardrails/01-03-SUMMARY.md.
</output>
