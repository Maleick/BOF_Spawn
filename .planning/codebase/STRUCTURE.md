# Codebase Structure

**Analysis Date:** 2026-02-25

## Directory Layout

```
BOF_Spawn/
├── Src/                   # Core BOF source, headers, and assembly trampoline
├── Bin/                   # Build artifacts and temp object directory
│   └── temp/              # Intermediate .o files during build
├── BOF_spawn.cna          # Cobalt Strike Aggressor script entrypoint
├── Makefile               # Cross-compile and link pipeline for Bin/bof.o
├── Dockerfile             # Reproducible build environment
├── README.md              # Usage, architecture, and operator notes
└── idea.md                # Brainstorm workspace document
```

## Directory Purposes

**`Src/`:**
- Purpose: all BOF implementation code and Windows/native declarations
- Contains: `.c`, `.h`, and `.s` files
- Key files: `Src/Bof.c`, `Src/Draugr.c`, `Src/Stub.s`, `Src/Native.h`
- Subdirectories: none (flat)

**`Bin/`:**
- Purpose: compiled outputs and temporary object staging
- Contains: `bof.o` output (when built), `.gitkeep`, temp objects under `Bin/temp/`
- Key files: `Bin/.gitkeep`, `Bin/temp/.gitkeep`
- Subdirectories: `temp/`

## Key File Locations

**Entry Points:**
- `BOF_spawn.cna`: Operator commands (`spawn_beacon`, `spawn_shellcode`) and config dialog
- `Src/Bof.c`: BOF entry `go()` and injection orchestration `SpawnAndRun()`

**Configuration:**
- `Makefile`: toolchain paths, compiler flags, link flow
- `Dockerfile`: apt sources + tool installation for container build env
- `BOF_spawn.cna`: default runtime config values for process path, PPID spoof, exec method

**Core Logic:**
- `Src/Bof.c`: process creation, shellcode write, execution method handling
- `Src/Draugr.c`: syscall resolution and spoofed call machinery
- `Src/Stub.s`: low-level trampoline/fixup routine
- `Src/Macros.h`: syscall/API variadic wrapper macros

**Testing:**
- No dedicated test directory or test files in repository

**Documentation:**
- `README.md`: primary technical/operator documentation
- `idea.md`: brainstorming notes (non-runtime)

## Naming Conventions

**Files:**
- C sources/headers largely PascalCase style (`Bof.c`, `Vulcan.h`, `Native.h`)
- Assembly file uses short functional name (`Stub.s`)
- Root docs use uppercase for canonical docs (`README.md`) and lowercase for workspace notes (`idea.md`)

**Directories:**
- PascalCase top-level source/artifact dirs (`Src`, `Bin`)
- Lowercase temp folder (`temp`)

**Special Patterns:**
- `.gitkeep` used to preserve empty artifact directories
- BOF-related declarations centralized in `Src/Beacon.h` and `Src/Bofdefs.h`

## Where to Add New Code

**New BOF Feature:**
- Primary implementation: `Src/Bof.c` or new `Src/<Feature>.c`
- Shared types/macros: `Src/*.h` (prefer narrowly scoped headers)
- Operator-facing config/command updates: `BOF_spawn.cna`

**New Execution Method:**
- Enum and switch integration: `Src/Bof.c`
- Syscall/helper support if needed: `Src/Draugr.c`, `Src/VxTable.h`, `Src/Macros.h`

**Build/Tooling Changes:**
- Native build path: `Makefile`
- Containerized build path: `Dockerfile`

**Documentation:**
- User/operator docs: `README.md`
- Planning/codebase docs: `.planning/codebase/*.md`

## Special Directories

**`Bin/temp/`:**
- Purpose: intermediate object file staging during `make spawn_bof`
- Source: generated by assembler/compiler invocation
- Committed: directory placeholder only (`.gitkeep`)

**`.planning/codebase/`:**
- Purpose: GSD-generated codebase intelligence docs
- Source: mapping workflow (`$gsd-map-codebase`)
- Committed: yes, when `commit_docs=true` and not gitignored

---

*Structure analysis: 2026-02-25*
*Update when files/directories are added, removed, or moved*
